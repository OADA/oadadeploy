#! /bin/bash

GREEN=$'\033[0;32m'
YELLOW=$'\033[1;33m'
CYAN=$'\033[0;36m'
NC=$'\033[0m' # No Color
SCRIPTNAME=$0

# If no OADA_HOME, set it to the absolute path of this script
if ! test -d OADA_HOME; then
  OADA_HOME="$( cd "$(dirname "$0")" >/dev/null 2>&1 ; pwd -P )"
fi
cd "${OADA_HOME}"


#----------------------------------------------------------------------------
#----------------------------------------------------------------------------
# Utilities:
#----------------------------------------------------------------------------
#----------------------------------------------------------------------------

source util.sh



#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------
# compose
#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------

source compose.sh




#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------
# admin 
#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------

source admin.sh



#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------
# migrate 
#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------

source migrate.sh



#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------
# fetch/upgrade
#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------

source upgrade.sh




#-------------------------------------------------------------------------
#-------------------------------------------------------------------------
# usage
#-------------------------------------------------------------------------
#-------------------------------------------------------------------------

source usage.sh




#----------------------------------------------------------------------------
#----------------------------------------------------------------------------
# init
#----------------------------------------------------------------------------
#----------------------------------------------------------------------------

source init.sh


#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------
# Main command sorting:
#-----------------------------------------------------------------------------
#-----------------------------------------------------------------------------

# verify we have curl, docker, docker-compose
require() {
  local ERRS
  ERRS=""
  for i in $@; do
    if ! command -v $i ] &> /dev/null; then
      ERRS="${ERRS}\nERROR: $SCRIPTNAME requires command $i"
    fi
  done
  if [ ! "x${ERRS}" == "x" ]; then 
    echo -e $ERRS
    exit
  fi
} 
require curl docker docker-compose

# usage exits this script when done
[ "$#" -lt 1 ] && usage

CMD=$1
shift
case $CMD in 
  # Exact list of docker-compose commands to pass thru
  build|config|create|down|events|exec|help|images|kill|logs|pause|port|ps|pull|push|restart|rm|run|scale|start|stop|top|unpause|up) 
    compose $CMD $@

  ;;
  admin) admin $@ ;;
  init) init $@ ;;
  upgrade) upgrade $@ ;;
  domain) domain $@ ;;
  service) service $@ ;;
  migrate) migrate $@ ;;
  help|--help|-h) usage $@ ;;
  *) usage $@
esac


